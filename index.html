<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AmitTV Premium â€“ Live Hindi Streams</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #ff2e2e;
            --bg: #0a0a0a;
            --card-bg: #1a1a1a;
            --success: #2ecc71;
            --error: #e74c3c;
            --unknown: #555;
            --text: #ffffff;
            --sidebar-width: 350px;
        }

        * { box-sizing: border-box; transition: background 0.2s ease; }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        header {
            background: rgba(17, 17, 17, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #222;
            z-index: 100;
        }
        .logo-text { font-size: 22px; font-weight: 800; }
        .logo-text span { color: var(--primary); }

        .main { flex: 1; display: flex; overflow: hidden; position: relative; }

        #sidebar {
            width: var(--sidebar-width);
            background: var(--bg);
            border-right: 1px solid #222;
            display: flex;
            flex-direction: column;
        }

        .search-container { padding: 15px; }
        #search {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #333;
            background: #111;
            color: white;
            outline: none;
        }
        #search:focus { border-color: var(--primary); }

        #channels { flex: 1; overflow-y: auto; }

        /* --- Channel Item --- */
        .channel {
            padding: 12px 15px;
            margin: 4px 10px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 3px solid transparent;
        }
        .channel:hover { background: #1a1a1a; }
        .channel.active { 
            background: #222; 
            border-left-color: var(--primary);
        }

        /* Status Dots Restoration */
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .status-dot.unknown { background: var(--unknown); }
        .status-dot.green { 
            background: var(--success); 
            box-shadow: 0 0 8px var(--success);
            animation: pulse 1.5s infinite;
        }
        .status-dot.red { background: var(--error); box-shadow: 0 0 8px var(--error); }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .img-container {
            width: 40px; height: 40px;
            background: #222;
            border-radius: 6px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }
        .img-container img { width: 100%; height: 100%; object-fit: contain; }

        .name-container { flex: 1; overflow: hidden; }
        .name { font-size: 14px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- Player --- */
        #player-container {
            flex: 1;
            background: #000;
            display: flex;
            align-items: center;
            position: relative;
        }
        video { width: 100%; height: auto; max-height: 100%; background: #000; }

        #loader {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            display: none; z-index: 5;
        }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid #333;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- Mobile Optimization --- */
        @media (max-width: 768px) {
            .main { flex-direction: column; }
            #sidebar { width: 100%; height: 50%; border-right: none; border-top: 1px solid #222; }
            #player-container { height: 35vh; flex: none; }
        }

        footer {
            padding: 8px; text-align: center; font-size: 11px; color: #555;
            background: #0a0a0a; border-top: 1px solid #111;
        }
    </style>
</head>
<body>

<header>
    <div class="logo-text">ðŸ“º AMIT<span>TV</span></div>
</header>

<div class="main">
    <div id="sidebar">
        <div class="search-container">
            <input id="search" placeholder="Search Hindi channel...">
        </div>
        <div id="channels"></div>
    </div>

    <div id="player-container">
        <div id="loader"><div class="spinner"></div></div>
        <video id="video" controls autoplay playsinline></video>
    </div>
</div>

<footer>Â© 2026 AMITTV | RESTORED STATUS INDICATORS</footer>

<script>
const PLAYLIST = "https://iptv-org.github.io/iptv/languages/hin.m3u";
const video = document.getElementById("video");
const channelsDiv = document.getElementById("channels");
const searchInput = document.getElementById("search");
const loader = document.getElementById("loader");

let hls;
let channels = [];
let currentIndex = -1;
let checkTimer;

// Fetch Playlist
fetch(PLAYLIST)
.then(r => r.text())
.then(text => {
    let name="", logo="";
    text.split("\n").forEach(line => {
        line = line.trim();
        if(line.startsWith("#EXTINF")){
            name = line.split(",")[1] || "Hindi Channel";
            const match = line.match(/tvg-logo="([^"]+)"/);
            logo = match ? match[1] : "";
        }
        if(line.startsWith("http")){
            channels.push({name, url: line, logo, status:"unknown"});
            logo="";
        }
    });
    render();
    if(channels.length > 0) playChannel(0);
});

function render() {
    channelsDiv.innerHTML = "";
    const filter = searchInput.value.toLowerCase();

    channels.forEach((c, i) => {
        if(!c.name.toLowerCase().includes(filter)) return;

        const div = document.createElement("div");
        div.className = `channel ${i === currentIndex ? 'active' : ''}`;
        
        const imgContent = c.logo 
            ? `<img src="${c.logo}" onerror="this.parentElement.innerHTML='ðŸ“º'">`
            : `ðŸ“º`;

        div.innerHTML = `
            <div class="status-dot ${c.status}"></div>
            <div class="img-container">${imgContent}</div>
            <div class="name-container">
                <div class="name">${c.name}</div>
            </div>
        `;
        
        div.onclick = () => playChannel(i);
        channelsDiv.appendChild(div);
    });
}

function playChannel(i) {
    if(i < 0 || i >= channels.length) return;
    
    currentIndex = i;
    clearTimeout(checkTimer);
    if(hls) { hls.destroy(); hls = null; }

    // Reset status for current selection to unknown until verified
    channels[i].status = "unknown";
    render();
    
    loader.style.display = "block";
    const url = channels[i].url;

    // Success detection
    video.onplaying = () => {
        loader.style.display = "none";
        clearTimeout(checkTimer);
        channels[i].status = "green";
        render();
    };

    // Error detection
    const markFailed = () => {
        loader.style.display = "none";
        channels[i].status = "red";
        render();
        // Auto-try next if current one fails
        if(i === currentIndex) playChannel(i + 1);
    };

    video.onerror = markFailed;
    checkTimer = setTimeout(markFailed, 10000); // 10 second timeout

    if(Hls.isSupported()){
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.ERROR, (e, data) => {
            if(data.fatal) markFailed();
        });
    } else if(video.canPlayType("application/vnd.apple.mpegurl")){
        video.src = url;
    }
}

searchInput.oninput = render;
</script>

</body>
</html>
